---
import BlogStyles from '../components/BlogStyles.astro';
const nombre = "Eduardo";
const hoy = new Date().toLocaleDateString('es-ES');
---

<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blog | {nombre}</title>
    <BlogStyles />
  </head>
  <body class="home-page">
    <header>
      <h1>¡Hola {nombre}!</h1>
      <p style="color: #00e5ff;">Hoy es: {hoy}</p>
    </header>

    <main class="main-container">
      <section class="card">
        <h2 style="font-size: 0.9rem; color: #00e5ff; margin-bottom: 1.5rem;">NUEVA ENTRADA</h2>
        <form id="post-form" class="blog-form">
          <input name="title" type="text" placeholder="Título" required />
          <textarea name="body" rows="5" placeholder="¿Qué piensas?" required></textarea>
          <button type="submit" class="btn-submit">Publicar ahora</button>
        </form>
      </section>

      <section class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
          <h2 style="font-size: 0.9rem; margin: 0;">RECIENTES</h2>
          <a href="/entradas" class="btn-link">VER TODAS</a>
        </div>
        <div id="recent-list"></div>
      </section>
    </main>

    <script>
      import { createClient } from '@supabase/supabase-js';
      const supabase = createClient(import.meta.env.PUBLIC_SUPABASE_URL, import.meta.env.PUBLIC_SUPABASE_ANON_KEY);
      const listEl = document.getElementById('recent-list');

      const load = async () => {
        const { data } = await supabase.from('entradas').select('*').order('created_at', { ascending: false }).limit(5);
        if (listEl && data) {
          listEl.innerHTML = data.map(e => `
            <div style="border-bottom: 1px solid rgba(255,255,255,0.05); padding: 1rem 0;">
              <h3 style="margin:0; font-size:1.1rem;">${e.title}</h3>
              <p style="margin:0.5rem 0 0; font-size:0.9rem; color:rgba(255,255,255,0.6);">${e.body}</p>
            </div>
          `).join('');
        }
      };

      document.getElementById('post-form')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const fd = new FormData(e.target as HTMLFormElement);
        await supabase.from('entradas').insert([{ title: fd.get('title'), body: fd.get('body') }]);
        (e.target as HTMLFormElement).reset();
        load();
      });
      load();
    </script>
  </body>
</html>