---
import BlogStyles from '../components/BlogStyles.astro';
---

<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Entradas</title>
    <BlogStyles />
  </head>
  <body class="entradas-page">
    <header>
      <h1>Últimas Entradas</h1>
    </header>

    <main id="grid" class="main-container">
      </main>

    <footer style="text-align: center; padding: 4rem;">
      <a href="/" class="btn-link">← VOLVER AL INICIO</a>
    </footer>

    <script>
      import { createClient } from '@supabase/supabase-js';
      const supabase = createClient(import.meta.env.PUBLIC_SUPABASE_URL, import.meta.env.PUBLIC_SUPABASE_ANON_KEY);

      const load = async () => {
        const container = document.getElementById('grid');
        const { data } = await supabase.from('entradas').select('*').order('created_at', { ascending: false });
        if (container && data) {
          container.innerHTML = '';
          data.forEach(e => {
            const div = document.createElement('div');
            div.className = 'card';
            div.style.display = 'flex';
            div.style.flexDirection = 'column';
            div.innerHTML = `
              <h2 style="margin:0 0 1rem;">${e.title}</h2>
              <p style="flex-grow:1; opacity:0.7;">${e.body}</p>
              <div style="margin-top:1.5rem; display:flex; justify-content:space-between; align-items:center;">
                <span style="font-size:0.8rem; color:#00e5ff;">${new Date(e.created_at).toLocaleDateString()}</span>
                <button class="delete-btn" data-id="${e.id}">Eliminar</button>
              </div>
            `;
            div.querySelector('.delete-btn')?.addEventListener('click', async () => {
              if (confirm('¿Borrar?')) {
                await supabase.from('entradas').delete().eq('id', e.id);
                load();
              }
            });
            container.appendChild(div);
          });
        }
      };
      load();
    </script>
  </body>
</html>