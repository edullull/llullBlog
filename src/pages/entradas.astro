---
import BlogStyles from '../components/BlogStyles.astro';
---

<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><rect fill='%230f1629' width='64' height='64'/><circle fill='%2399b4ff' cx='32' cy='32' r='18'/><path fill='%23ffffff' d='M25 34l7-12 7 12h-14z'/></svg>"
    />
    <title>Últimas Entradas | LlullBlog</title>
    <BlogStyles />
    <style>
      /* Estilo extra para el botón de eliminar */
      .delete-btn {
        background: rgba(255, 107, 107, 0.2);
        color: #ff6b6b;
        border: 1px solid rgba(255, 107, 107, 0.4);
        padding: 5px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.8rem;
        margin-top: 1rem;
        transition: all 0.2s;
      }
      .delete-btn:hover {
        background: #ff6b6b;
        color: white;
      }
    </style>
  </head>
  <body class="entradas-page">
    <header>
      <h1>Últimas Entradas</h1>
    </header>

    <main id="main-container">
      <p class="muted" style="text-align: center;">Cargando entradas...</p>
    </main>

    <footer>
      <p>
        <a href="/">← Volver al inicio</a>
      </p>
    </footer>

    <script>
      import { createClient } from '@supabase/supabase-js';

      // Configuración de Supabase
      const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL;
      const supabaseKey = import.meta.env.PUBLIC_SUPABASE_ANON_KEY;
      const supabase = createClient(supabaseUrl, supabaseKey);

      const mainContainer = document.getElementById('main-container');

      const renderEntries = async () => {
        if (!mainContainer) return;

        const { data: entries, error } = await supabase
          .from('entradas')
          .select('*')
          .order('created_at', { ascending: false });

        if (error) {
          mainContainer.innerHTML = '<p class="muted">Error al cargar datos.</p>';
          return;
        }

        if (!entries || entries.length === 0) {
          mainContainer.innerHTML = '<p class="muted">No hay entradas publicadas todavía.</p>';
          return;
        }

        mainContainer.innerHTML = '';
        entries.forEach((entry) => {
          const section = document.createElement('section');
          const fecha = entry.date || new Date(entry.created_at).toLocaleDateString('es-ES');
          
          section.innerHTML = `
            <h2>${entry.title}</h2>
            <p>${entry.body}</p>
            <p><small>Publicado el: ${fecha}</small></p>
            <button class="delete-btn" data-id="${entry.id}">Eliminar entrada</button>
          `;
          
          // Evento para eliminar
          const btn = section.querySelector('.delete-btn');
          btn?.addEventListener('click', async () => {
            if (confirm('¿Seguro que quieres borrar esta entrada?')) {
              const { error: delError } = await supabase
                .from('entradas')
                .delete()
                .eq('id', entry.id);
              
              if (!delError) {
                renderEntries(); // Refrescar lista
              } else {
                alert('Error al borrar');
              }
            }
          });

          mainContainer.appendChild(section);
        });
      };

      renderEntries();
    </script>
  </body>
</html>